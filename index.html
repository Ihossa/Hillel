<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>lesson21</title>
</head>
<body>



	<script>

		"use strict"
		const $List = document.createElement("ul");
		$List.addEventListener("click", function(el){

			const $el = el.target;

			if($el.firstElementChild){$el.removeChild($el.firstElementChild);}
			else{
			const sublist = document.createElement("ul")
			$el.append(sublist);

			
			if($el.tagName === "LI"){

				getDataApi("https://swapi.dev/api/films/").then(function(films){
					
					films.results.map(function elList(list){

						if(list.title === $el.textContent){
							list.starships.forEach(function(el){

								getDataApi(el).then(function(ship){
									//console.log(ship.name);
									sublist.innerHTML += `<li>${ship.name}</li>`
									
								})
							})
						}	
					}) 
				})
			}
			}
		})
		

		getDataApi("https://swapi.dev/api/films/").then(function(films){

			films.results.forEach(function elList(list){
				//console.log(list);
				$List.innerHTML += `<li>${list.title}</li>`;
				document.body.prepend($List);
			})

		})


		function getDataApi(adres){
			 function getFilmApi(){
				return fetch(adres);
			}
			return getFilmApi()
			.then(function(resp){
				return resp.json();
			})			
		}
		
		

	</script>
</body>
</html>